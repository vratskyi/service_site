---
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<div class="text-base md:text-sm inline-flex pt-1">
  {t("nav.city")} ğŸ•<span id="weather"></span>
</div>

<script type="text/javascript" transition:persist>
  document.addEventListener("astro:page-load", () => {
    const api =
      "http://api.weatherapi.com/v1/current.json?key=f93e372191eb42b981702543240903&q=Kyiv&aqi=no";

    const weatherIcons = {
      1000: "â˜€ï¸", // SunnyThe
      1003: "â›…", // Partly cloudy
      1006: "â˜ï¸", // Cloudy
      1009: "â˜ï¸", // Overcast
      1030: "ğŸŒ«ï¸", // Mist
      1063: "ğŸŒ¦ï¸", // Patchy rain possible
      1066: "ğŸŒ¨ï¸", // Patchy snow possible
      1069: "ğŸŒ¨ï¸", // Patchy sleet possible
      1072: "ğŸŒ¨ï¸", // Patchy freezing drizzle possible
      1087: "ğŸŒ©ï¸", // Thundery outbreaks possible
      1114: "â„ï¸", // Blowing snow
      1117: "â„ï¸", // Blizzard
      1135: "ğŸŒ«ï¸", // Fog
      1147: "ğŸŒ«ï¸", // Freezing fog
      1150: "ğŸŒ§ï¸", // Patchy light drizzle
      1153: "ğŸŒ§ï¸", // Light drizzle
      1168: "ğŸŒ§ï¸", // Freezing drizzle
      1171: "ğŸŒ§ï¸", // Heavy freezing drizzle
      1180: "ğŸŒ§ï¸", // Patchy light rain
      1183: "ğŸŒ§ï¸", // Light rain
      1186: "ğŸŒ§ï¸", // Moderate rain at times
      1189: "ğŸŒ§ï¸", // Moderate rain
      1192: "ğŸŒ§ï¸", // Heavy rain at times
      1195: "ğŸŒ§ï¸", // Heavy rain
      1198: "ğŸŒ§ï¸", // Light freezing rain
      1201: "ğŸŒ§ï¸", // Moderate or heavy freezing rain
      1204: "ğŸŒ¨ï¸", // Light sleet
      1207: "ğŸŒ¨ï¸", // Moderate or heavy sleet
      1210: "ğŸŒ¨ï¸", // Patchy light snow
      1213: "ğŸŒ¨ï¸", // Light snow
      1216: "ğŸŒ¨ï¸", // Patchy moderate snow
      1219: "ğŸŒ¨ï¸", // Moderate snow
      1222: "ğŸŒ¨ï¸", // Patchy heavy snow
      1225: "ğŸŒ¨ï¸", // Heavy snow
      1237: "ğŸŒ¨ï¸", // Ice pellets
      1240: "ğŸŒ§ï¸", // Light rain shower
      1243: "ğŸŒ§ï¸", // Moderate or heavy rain shower
      1246: "ğŸŒ§ï¸", // Torrential rain shower
      1249: "ğŸŒ¨ï¸", // Light sleet showers
      1252: "ğŸŒ¨ï¸", // Moderate or heavy sleet showers
      1255: "ğŸŒ¨ï¸", // Light snow showers
      1258: "ğŸŒ¨ï¸", // Moderate or heavy snow showers
      1261: "ğŸŒ¨ï¸", // Light showers of ice pellets
      1264: "ğŸŒ¨ï¸", // Moderate or heavy showers of ice pellets
      1273: "ğŸŒ©ï¸", // Patchy light rain with thunder
      1276: "ğŸŒ©ï¸", // Moderate or heavy rain with thunder
      1279: "ğŸŒ¨ï¸", // Patchy light snow with thunder
      1282: "ğŸŒ¨ï¸", // Moderate or heavy snow with thunder
    };

    const defaultIcon = "â“"; // Ğ˜ĞºĞ¾Ğ½ĞºĞ° Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹

    async function fetchData() {
      try {
        const response = await fetch(api);
        const json = await response.json();

        const temp = json.current.temp_c;
        const localtime = json.location.localtime;
        const time = localtime.slice(10, 16).replace(/\s/g, "");
        const condition = json.current.condition.code;

        const conditionIcon = weatherIcons[Number(condition)] || defaultIcon;

        const roundedTemp = Math.round(Number(temp));

        const weatherElement = document.getElementById("weather");
        weatherElement.innerHTML = `&nbsp;${time}&nbsp;${conditionIcon}&nbsp;${roundedTemp}Â°C`;

        // Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ Ğ² 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼
        setTimeout(fetchData, 10 * 60 * 1000);
      } catch (error) {
        console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ API:", error);
      }
    }

    // Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ fetchData Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
    fetchData();
  });
</script>
