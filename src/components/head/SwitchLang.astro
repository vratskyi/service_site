---
import { languages } from "../../i18n/ui";
import { useTranslatedPath } from "../../i18n/utils";
---


<div class="dropdown dropdown-start">
  <div tabindex="0" role="button" class="btn m-1 rounded-full bg-base-300 stroke-current hover:text-primary duration-150">
    <svg class="inline-block w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
      <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m10.5 21l5.25-11.25L21 21m-9-3h7.5M3 5.621a48.474 48.474 0 0 1 6-.371m0 0c1.12 0 2.233.038 3.334.114M9 5.25V3m3.334 2.364C11.176 10.658 7.69 15.08 3 17.502m9.334-12.138A47.63 47.63 0 0 1 15 5.621m-4.589 8.495a18.023 18.023 0 0 1-3.827-5.802" />
    </svg>
  </div>
  <ul tabindex="0" id="langSelect" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
    {
      Object.entries(languages).map(([lang, label]) => (
        <li><a href={useTranslatedPath(lang)('/')} class="stroke-current hover:text-primary duration-150">{label}</a></li>
      ))
    }
  </ul>
</div>


<!-- <script type="text/javascript" transition:persist>
    document.addEventListener('astro:page-load', () => {
  let selectedLang = document.cookie.replace(
    /(?:(?:^|.*;\s*)selectedLang\s*\=\s*([^;]*).*$)|^.*$/,
    "$1"
  );
  // Если cookie selectedLang не установлен, установить его на ru
  if (!selectedLang) {
    selectedLang = "ru";
    document.cookie = "selectedLang=" + selectedLang + "; path=/";
  }
  const langSelect = document.getElementById("langSelect");
  if (langSelect) {
    const selectedOption = langSelect.querySelector(`a[href="${selectedLang}"]`);
    if (selectedOption) {
      selectedOption.classList.add('selected');
    }
    langSelect.querySelectorAll('a').forEach(function(a) {
      a.addEventListener('click', function () {
        document.cookie = "selectedLang=" + this.getAttribute('href') + "; path=/";
        let newPath = window.location.pathname.replace(
          /\/[a-z]{2}\//,
          "/" + this.getAttribute('value') + "/"
        );
        if (newPath.includes("/blog/")) {
          newPath = newPath.substring(0, newPath.indexOf("/blog/") + 6);
        }
        window.location.href = newPath;
      });
    });
  }
});

</script> -->
